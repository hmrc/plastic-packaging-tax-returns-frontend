@*
 * Copyright 2022 HM Revenue & Customs
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *@

@import uk.gov.hmrc.plasticpackagingtax.returns.config.AppConfig
@import uk.gov.hmrc.plasticpackagingtax.returns.models.request.AuthenticatedRequest
@import uk.gov.hmrc.plasticpackagingtax.returns.models.subscription.subscriptionDisplay.SubscriptionDisplayResponse
@import uk.gov.hmrc.plasticpackagingtax.returns.views.html.components.{card, cardSection, link, pageTitle, paragraph, sectionHeader}
@import uk.gov.hmrc.plasticpackagingtax.returns.views.html.main_template
@import uk.gov.hmrc.plasticpackagingtax.returns.views.model.Title

@this(
        govukLayout: main_template,
        pageTitle: pageTitle,
        sectionHeader: sectionHeader,
        paragraph: paragraph,
        card: card,
        cardSection: cardSection,
        link: link,
        appConfig: AppConfig
)


@(subscription: SubscriptionDisplayResponse, paymentStatement: Option[String], completeReturnUrl: String, pptReference: String)(implicit request: AuthenticatedRequest[_], messages: Messages)

@organisationName = @{
    if(subscription.isGroup)
        messages("account.homePage.organisation.group", subscription.entityName)
    else
        subscription.entityName
}

@link1Text = @{
    if(subscription.isGroup)
        messages("account.homePage.card.registration.details.1.link.group")
    else if(subscription.isPartnership)
        messages("account.homePage.card.registration.details.1.link.partnership")
    else
        messages("account.homePage.card.registration.details.1.link.single")
}

@link2Text = @{
    if(subscription.isGroup)
        messages("account.homePage.card.registration.details.2.link.group")
    else if(subscription.isPartnership)
        messages("account.homePage.card.registration.details.2.link.partnership")
    else
        ""
}

@singleEntityManagement = {
    <div class="govuk-grid-row govuk-!-margin-top-4">
        <div id="core-management" class="govuk-grid-column-one-third">
            @cardSection(
                link = link(text = link1Text, call = Call("GET", appConfig.pptRegistrationAmendUrl)),
                body = messages("account.homePage.card.registration.details.1.body")
            )
        </div>
    </div>
}

@groupManagement = {
    <div class="govuk-grid-row govuk-!-margin-top-4">
        <div id="core-management" class="govuk-grid-column-one-third">
            @cardSection(
                link = link(text = link1Text, call = Call("GET", appConfig.pptRegistrationAmendUrl)),
                body = messages("account.homePage.card.registration.details.1.body")
            )
        </div>
        <div id="additional-management" class="govuk-grid-column-one-third">
            @cardSection(
                link = link(text = link2Text, call = Call("GET", appConfig.pptRegistrationManageGroupUrl)),
                body = messages("account.homePage.card.registration.details.2.body.group")
            )
        </div>
    </div>
}

@partnershipManagement = {
    <div class="govuk-grid-row govuk-!-margin-top-4">
        <div id="core-management" class="govuk-grid-column-one-third">
            @cardSection(
                link = link(text = link1Text, call = Call("GET", appConfig.pptRegistrationAmendUrl)),
                body = messages("account.homePage.card.registration.details.1.body")
            )
        </div>
        <div id="additional-management" class="govuk-grid-column-one-third">
            @cardSection(
                link = link(text = link2Text, call = Call("GET", appConfig.pptRegistrationManagePartnersUrl)),
                body = messages("account.homePage.card.registration.details.2.body.partnership")
            )
        </div>
    </div>
}

@managementCards = @{
        if (subscription.isGroup) {
            groupManagement
        } else if (subscription.isPartnership) {
            partnershipManagement
        } else {
            singleEntityManagement
        }
}

@govukLayout(title = Title("account.homePage.title"), useCustomContentWidth = true) {

    @pageTitle(text = messages("account.homePage.title"))

    @paragraph {
        @messages("account.homePage.registrationNumber", pptReference) </br>
        @organisationName
    }

    <div class="govuk-grid-row govuk-!-margin-top-6">

        @card(header = messages("account.homePage.card.makeReturn.header"),
            body = messages("account.homePage.card.makeReturn.body", "April", "June", "2022", "29 July 2022"),
            links = Seq(
                link(text = messages("account.homePage.card.makeReturn.link"), call = Call("GET", completeReturnUrl), newTab = true)
            )

        )

        @card(header = messages("account.homePage.card.payments.header"),
            body = paymentStatement.getOrElse(messages("account.homePage.card.payments.error")),
            links = Seq.empty
        )
    </div>

    <h2 class="govuk-heading-m">@messages("account.homePage.manage.ppt.account.header")</h2>

    @managementCards
}

