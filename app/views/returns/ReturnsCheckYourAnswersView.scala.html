@*
 * Copyright 2022 HM Revenue & Customs
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *@

@import controllers.helpers.TaxLiability
@import models.returns.TaxReturnObligation
@import viewmodels.InputWidth
@import components.{Link, bulletList, paragraph, paragraphBody}

@this(
    layout: templates.Layout,
    govukSummaryList: GovukSummaryList,
    govukButton: GovukButton,
    formHelper: FormWithCSRF,
    govukTable: GovukTable,
    paragraphBody: paragraphBody,
    paragraph: paragraph,
    bulletList: bulletList,
    link: Link
)

@(list: SummaryList, taxLiability: TaxLiability, taxReturn: TaxReturnObligation,
        pptReference: String, creditAdviceLnkUrl: String)(implicit request: Request[_], messages: Messages)

@taxCalculationRow(key: String, value: String, classes: String = "govuk-body", attributes: Map[String, String] = Map()) = @{
    Seq(
        TableRow(
        content = Text(messages(key)),
        classes = classes,
        attributes = attributes
        ),
        TableRow(
        content = Text(value),
        classes = classes,
        format = Some("numeric"),
        attributes = attributes
        ),
        TableRow(
        classes = classes,
        attributes = attributes
        )
    )
}

@hiddenText(key: String) = @{
    HtmlContent(Html(s"""<span class="govuk-visually-hidden">${messages(key)}</span>"""))
}

@toLongKey(shortKey: String) = @{
    "submit-return.check-your-answers." + shortKey
}

@summaryRowTable(shortKey: String, value: String) = @{
    taxCalculationRow(toLongKey(shortKey), value)
}

@summaryRow(shortKey: String, value: String) = @{
    val text = messages("submit-return.check-your-answers." + shortKey)
    val classes = s"govuk-!-font-weight-regular ${InputWidth.ThreeQuarters}"
    SummaryListRow(key = Key(text, classes = classes), value = Value(value))
}

@sectionHeading(text: String)(implicit messages: Messages) = {
    <h2 class="govuk-heading-m govuk-!-margin-top-6">@messages(text)</h2>
}

@para(shortKey: String, classes: String = "govuk-body") = @{
    val text = messages("submit-return.check-your-answers." + shortKey)
    paragraphBody(message = text, classes=classes)
}

@bullets(shortKeys: String*) = @{
    bulletList(shortKeys.map { shortKey => Html(messages("submit-return.check-your-answers." + shortKey)) })
}

@paraLink(paraShortKey: String, linkShortKey: String, url: String) = @{
    def text(shortKey: String) = messages(toLongKey(shortKey))
    paragraph(content = Html(messages(toLongKey(paraShortKey), link(
        id = toLongKey(linkShortKey),
        text = text(linkShortKey),
        call = Call("GET", url),
        newTab = true
    ))))
}

@layout(pageTitle = titleNoForm(messages("submit-return.check-your-answers.heading"))) {

    <h1 class="govuk-heading-xl">@messages("submit-return.check-your-answers.heading")</h1>

    <!-- Business details -->
    @sectionHeading("submit-return.check-your-answers.business-details.heading")
    @govukSummaryList(SummaryList(
        rows = Seq(
            summaryRow("business-details.row1", pptReference),
            summaryRow("business-details.row2", taxReturn.toReturnQuarter)
        )
    ))

    <!-- Packaging total -->
    @sectionHeading("submit-return.check-your-answers.tax-calc.heading")
    @govukTable(Table(
        rows = Seq(
            taxCalculationRow("submit-return.check-your-answers.tax-calc.row1", taxLiability.plasticPackagingTotal),
            taxCalculationRow("submit-return.check-your-answers.tax-calc.row2", taxLiability.deductionsTotal),
            taxCalculationRow("submit-return.check-your-answers.tax-calc.row3", taxLiability.chargeableTotal),
            taxCalculationRow("submit-return.check-your-answers.tax-calc.row4", taxLiability.taxDue)
        ),

    ))

    <!-- Tax calculation -->
    @sectionHeading("submit-return.check-your-answers.tax-calc.heading")
    @govukTable(Table(
        rows = Seq(
            summaryRowTable("tax-calc.row1", taxLiability.plasticPackagingTotal),
            summaryRowTable("tax-calc.row2", taxLiability.deductionsTotal),
            summaryRowTable("tax-calc.row3", taxLiability.chargeableTotal),
            summaryRowTable("tax-calc.row4", taxLiability.taxDue)
        )
    ))
    @para("tax-calc.footnote")

    <!-- Credits -->
    @sectionHeading("submit-return.check-your-answers.credits.heading")
    @para("credits.line1")
    @para("credits.line2")
    @bullets("credits.line3", "credits.line4")
    @paraLink("credits.line5", "credits.line5.link-text", creditAdviceLnkUrl)

    <!-- Submit -->
    @sectionHeading("submit-return.check-your-answers.now-send.heading")
    @para("now-send.line1", classes="govuk-body govuk-!-margin-bottom-6")
    @formHelper(action = controllers.returns.routes.ReturnsCheckYourAnswersController.onSubmit(), 'autoComplete -> "off") {
        @govukButton(
            ButtonViewModel(messages("submit-return.check-your-answers.now-send.button-text"))
        )
    }
}
