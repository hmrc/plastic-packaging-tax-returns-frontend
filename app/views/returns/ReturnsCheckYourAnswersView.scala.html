@*
 * Copyright 2022 HM Revenue & Customs
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *@

@import models.returns.TaxReturnObligation
@import controllers.helpers.TaxLiability
@import components.paragraphBody
@import viewmodels.{PrintBigDecimal, PrintLong}
@import viewmodels.InputWidth
@import views.html.components.bulletList
@import views.html.components.Link
@import views.html.components.paragraph

@this(
    layout: templates.Layout,
    govukSummaryList: GovukSummaryList,
    govukButton: GovukButton,
    formHelper: FormWithCSRF,
    govukTable: GovukTable,
    paragraphBody: paragraphBody,
    paragraph: paragraph,
    bulletList: bulletList,
    link: Link
)

@(list: SummaryList, taxLiability: TaxLiability, taxReturn: TaxReturnObligation,
        pptReference: String, creditAdviceLnkUrl: String)(implicit request: Request[_], messages: Messages)

@taxCalculationRow(key: String, value: String, classes: String = "govuk-body", attributes: Map[String, String] = Map()) = @{
    Seq(
        TableRow(
        content = Text(messages(key)),
        classes = classes,
        attributes = attributes
        ),
        TableRow(
        content = Text(value),
        classes = classes,
        format = Some("numeric"),
        attributes = attributes
        ),
        TableRow(
        classes = classes,
        attributes = attributes
        )
    )
}

@hiddenText(key: String) = @{
    HtmlContent(Html(s"""<span class="govuk-visually-hidden">${messages(key)}</span>"""))
}

@summaryRow(shortKey: String, value: String) = @{
    val text = messages("submit-return.check-your-answers." + shortKey)
    SummaryListRow(key = Key(text, classes = InputWidth.ThreeQuarters.toString), value = Value(value))
}

@sectionHeading(text: String)(implicit messages: Messages) = {
    <h2 class="govuk-heading-m">@messages(text)</h2>
}

@para(shortKey: String) = @{
    val text = messages("submit-return.check-your-answers." + shortKey)
    paragraphBody(message = text)
}

@bullets(shortKeys: String*) = @{
    bulletList(shortKeys.map { shortKey => Html(messages("submit-return.check-your-answers." + shortKey)) })
}

@paraLink(paraShortKey: String, linkShortKey: String, url: String) = @{
    def longKey(shortKey: String) = "submit-return.check-your-answers." + shortKey
    def text(shortKey: String) = messages(longKey(shortKey))
    paragraph(content = Html(messages(longKey(paraShortKey), link(
        id = longKey(linkShortKey),
        text = text(linkShortKey),
        call = Call("GET", url),
        newTab = true
    ))))
}

@layout(pageTitle = titleNoForm(messages("submit-return.check-your-answers.heading"))) {

    <h1 class="govuk-heading-xl">@messages("submit-return.check-your-answers.heading")</h1>

    @sectionHeading("submit-return.check-your-answers.section1.heading")
    @govukSummaryList(SummaryList(
        rows = Seq(
            summaryRow("section1.row1", pptReference),
            summaryRow("section1.row2", taxReturn.toReturnQuarter)
        ),
        classes = "govuk-!-margin-bottom-9"
    ))

    @sectionHeading("submit-return.check-your-answers.section2.heading")
    @govukSummaryList(list)

    @govukTable(Table(
        rows = Seq(
            taxCalculationRow("returnsCheckYourAnswers.taxLiability.exemptPackaging.label", taxLiability.totalKgExempt.asKgs),
            taxCalculationRow("returnsCheckYourAnswers.taxLiability.liablePackaging.label", taxLiability.totalKgLiable.asKgs, "row-border"),
            taxCalculationRow("returnsCheckYourAnswers.taxLiability.label", taxLiability.taxDue.asPounds, "row-border")
            ),
        head = Some(Seq(
            HeadCell(
                content = hiddenText("returns.checkYourReturnPage.header.item"),
                classes = "govuk-!-width-one-half"
            ),
        HeadCell(
            content = hiddenText("returns.checkYourReturnPage.header.amount"),
            classes = "govuk-!-width-one-quarter",
            format = Some("numeric")
            ),
        HeadCell(
            content = hiddenText("returns.checkYourReturnPage.header.empty"),
            classes = "govuk-!-width-one-quarter"
        ))),
        caption = Some(messages("returnsCheckYourAnswers.taxLiability.subheading")),
        captionClasses = "govuk-table__caption--m",
        firstCellIsHeader = true,
        classes = "row-header--no-border cell--no-border "
    ))

    @paragraphBody(messages("returnsCheckYourAnswers.taxLiability.description"), classes = "govuk-body-m")

    @sectionHeading("submit-return.check-your-answers.credits.heading")
    @para("credits.line1")
    @para("credits.line2")
    @bullets("credits.line3", "credits.line4")
    @paraLink("credits.line5", "credits.line5.link-text", creditAdviceLnkUrl)

    @sectionHeading("Now send your return")

    @formHelper(action = controllers.returns.routes.ReturnsCheckYourAnswersController.onSubmit(), 'autoComplete -> "off") {
        @govukButton(
            ButtonViewModel(messages("site.continue.confirm"))
        )
    }
}
